---
const { service, index } = Astro.props;
const displayIndex = index < 10 ? `0${index}` : index;
---

<div
  class="service-row group relative border-b border-gray-200 py-8 md:py-14 px-4 lg:py-26 transition-colors hover:bg-gray-50/80 overflow-hidden md:overflow-visible"
>
  <div
    class="container mx-auto flex flex-col md:flex-row md:items-center relative z-10"
  >
    <div class="w-12">
      <span class="text-sm font-medium text-gray-400 font-mono"
        >{displayIndex}</span
      >
    </div>

    <div class="md:flex-1">
      <h3
        class="text-xl md:text-2xl  text-gray-900 tracking-tight group-hover:translate-x-3 transition-transform duration-500"
      >
        {service.name}
      </h3>
    </div>

    <div class="md:w-1/3 mt-4 md:mt-0">
      <p class="text-[12px] leading-relaxed text-gray-500 max-w-sm">
        {service.description}
      </p>
    </div>
  </div>

  <div
    class="floating-img-wrapper hidden md:block pointer-events-none absolute top-0 left-0 w-50 h-32 z-20 opacity-0 scale-75"
  >
    <img
      src={service.imageUrl}
      alt={service.name}
      class="w-full h-full object-cover shadow-2xl rounded-sm"
    />
  </div>

  <div class="mt-6 md:hidden w-full h-56 overflow-hidden rounded-sm">
    <img src={service.imageUrl} class="w-full h-full object-cover" />
  </div>
</div>

<script>
  import { gsap } from "gsap";

  const rows = document.querySelectorAll(".service-row");

  rows.forEach((row) => {
    const imgWrapper = row.querySelector(".floating-img-wrapper");

    if (window.innerWidth > 768) {
      row.addEventListener("mouseenter", () => {
        gsap.to(imgWrapper, {
          opacity: 1,
          scale: 1,
          duration: 0.4,
          ease: "power2.out",
        });
      });

      row.addEventListener("mouseleave", () => {
        gsap.to(imgWrapper, {
          opacity: 0,
          scale: 0.75,
          duration: 0.4,
          ease: "power2.in",
        });
      });

      row.addEventListener("mousemove", (e) => {
        const mouseEvent = e as MouseEvent;
        // Obtenemos la posición del ratón relativa a la FILA (row)
        const rect = row.getBoundingClientRect();
        const xPos = mouseEvent.clientX - rect.left;
        const yPos = mouseEvent.clientY - rect.top;

        gsap.to(imgWrapper, {
          x: xPos - 160, // Centrado horizontal (ancho 320 / 2)
          y: yPos - 100, // Centrado vertical (alto 200 / 2)
          duration: 0.6,
          ease: "power3.out",
        });
      });
    }
  });
</script>

<style>
  /* Para que el absolute funcione, el padre tiene relative (ya lo tiene service-row) */
  .service-row {
    perspective: 1000px;
  }
</style>
